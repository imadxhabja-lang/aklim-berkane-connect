<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Berkane Connect | Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ø§Ù„Ø´Ø§Ù…Ù„Ø© 2025</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&display=swap');
        
        :root {
            --primary-dark: #0f172a;
            --accent-gold: #f59e0b;
            --woman-pink: #ec4899;
            --repair-blue: #3b82f6;
            --bg-light: #f8fafc;
        }

        body { 
            font-family: 'Tajawal', sans-serif; 
            background-color: var(--bg-light);
            color: #1e293b;
            scroll-behavior: smooth;
        }

        /* --- Ù†Ø¶Ø§ÙØ© ÙˆØ¨Ù†Ø© Ø§Ù„ØªØµÙ…ÙŠÙ… --- */
        .glass-header {
            background: rgba(255, 255, 255, 0.96);
            backdrop-filter: blur(12px);
            border-bottom: 5px solid var(--accent-gold);
            box-shadow: 0 10px 30px -10px rgba(0,0,0,0.1);
        }

        .hero-section {
            background: linear-gradient(145deg, #0f172a, #1e293b);
            border-radius: 3.5rem;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .hero-section::before {
            content: '';
            position: absolute;
            top: -20%;
            right: -10%;
            width: 300px;
            height: 300px;
            background: var(--accent-gold);
            filter: blur(150px);
            opacity: 0.15;
        }

        /* Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø®Ø¯Ù…Ø§Øª */
        .service-card-premium {
            background: white;
            border-radius: 2.5rem;
            padding: 2.5rem;
            border: 1px solid #edf2f7;
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }

        .service-card-premium:hover {
            transform: translateY(-15px);
            box-shadow: 0 40px 70px -15px rgba(0,0,0,0.1);
            border-color: var(--accent-gold);
        }

        /* Ø£Ù„ÙˆØ§Ù† Ø­Ø³Ø¨ Ø§Ù„ØµÙ†Ù */
        .cat-woman { border-bottom: 8px solid var(--woman-pink); }
        .cat-repair { border-bottom: 8px solid var(--repair-blue); }
        .cat-kitchen { border-bottom: 8px solid #10b981; }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø®Ø¨Ø§Ø± */
        .breaking-news {
            background: var(--primary-dark);
            border-y: 2px solid var(--accent-gold);
            padding: 20px 0;
            overflow: hidden;
        }

        .news-scroll {
            display: inline-block;
            white-space: nowrap;
            animation: scroll-rtl 40s linear infinite;
            color: var(--accent-gold);
            font-weight: 800;
            font-size: 1.1rem;
        }

        @keyframes scroll-rtl {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙÙ„ØªØ±Ø© */
        .chip {
            padding: 15px 30px;
            border-radius: 1.5rem;
            background: white;
            border: 2px solid #e2e8f0;
            font-weight: 800;
            transition: 0.3s;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chip.active {
            background: var(--accent-gold);
            color: white;
            border-color: #d97706;
            box-shadow: 0 15px 25px -5px rgba(245, 158, 11, 0.4);
        }

        .wa-button {
            background: var(--primary-dark);
            color: var(--accent-gold);
            font-weight: 900;
            padding: 1.2rem;
            border-radius: 1.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            width: 100%;
            margin-top: 2rem;
            transition: 0.4s;
        }

        .wa-button:hover {
            background: #000;
            letter-spacing: 1px;
        }

        /* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… */
        .admin-glass {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
        }

        .custom-loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--accent-gold);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .hidden { display: none !important; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="antialiased">

    <nav class="glass-header sticky top-0 z-[1000] p-5 px-10 flex justify-between items-center">
        <div class="text-3xl font-black italic tracking-tighter text-slate-900">
            BERKANE<span class="text-amber-500">.</span>CONNECT
        </div>
        <div class="flex items-center gap-6">
            <button onclick="openModal('addModal')" class="bg-amber-500 text-white px-8 py-4 rounded-2xl text-sm font-black shadow-2xl hover:scale-105 active:scale-95 transition-all">
                <i class="fas fa-plus-circle ml-2"></i> Ø£Ø¶Ù Ø®Ø¯Ù…ØªÙƒ
            </button>
            <button onclick="adminGateway()" class="bg-slate-100 p-4 rounded-2xl text-slate-400 hover:text-slate-900 transition-colors">
                <i class="fas fa-fingerprint text-xl"></i>
            </button>
        </div>
    </nav>

    <div class="container mx-auto p-6 mt-6">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="hero-section p-10 text-white flex justify-between items-center shadow-2xl">
                <div>
                    <span class="text-amber-400 text-xs font-black uppercase tracking-widest opacity-80">Ø§Ù„Ø·Ù‚Ø³ Ø§Ù„Ø¢Ù† ÙÙŠ Ø¨Ø±ÙƒØ§Ù†</span>
                    <h2 id="weather-temp" class="text-6xl font-black italic mt-3 animate__animated animate__fadeIn">--Â°C</h2>
                    <p class="text-slate-400 text-sm mt-4 font-bold"><i class="fas fa-map-marker-alt ml-2"></i> Ø³ÙŠØ¯ÙŠ Ø³Ù„ÙŠÙ…Ø§Ù†ØŒ Ø¨Ø±ÙƒØ§Ù†</p>
                </div>
                <div id="weather-icon" class="text-7xl text-amber-500/20"><i class="fas fa-sun animate-pulse"></i></div>
            </div>

            <div class="lg:col-span-2 bg-white rounded-[3.5rem] p-8 shadow-sm border border-slate-50 flex justify-around items-center">
                <div class="text-center">
                    <span class="text-[10px] text-slate-400 font-black uppercase block mb-2">Ø§Ù„ÙØ¬Ø±</span>
                    <p id="fajr" class="text-2xl font-black italic text-slate-800">--:--</p>
                </div>
                <div class="text-center">
                    <span class="text-[10px] text-slate-400 font-black uppercase block mb-2">Ø§Ù„Ø¸Ù‡Ø±</span>
                    <p id="dhuhr" class="text-2xl font-black italic text-slate-800">--:--</p>
                </div>
                <div class="text-center bg-amber-50 p-6 rounded-[2rem] border-2 border-amber-100 scale-110">
                    <span class="text-[10px] text-amber-600 font-black uppercase block mb-2">Ø§Ù„Ø¹ØµØ±</span>
                    <p id="asr" class="text-2xl font-black italic text-amber-600">--:--</p>
                </div>
                <div class="text-center">
                    <span class="text-[10px] text-slate-400 font-black uppercase block mb-2">Ø§Ù„Ù…ØºØ±Ø¨</span>
                    <p id="maghrib" class="text-2xl font-black italic text-slate-800">--:--</p>
                </div>
                <div class="text-center">
                    <span class="text-[10px] text-slate-400 font-black uppercase block mb-2">Ø§Ù„Ø¹Ø´Ø§Ø¡</span>
                    <p id="isha" class="text-2xl font-black italic text-slate-800">--:--</p>
                </div>
            </div>
        </div>
    </div>

    <div class="breaking-news mt-10">
        <div class="news-scroll" id="news-ticker">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¢Ø®Ø± Ø§Ù„Ø£Ø®Ø¨Ø§Ø± ÙˆØ§Ù„Ù…Ø³ØªØ¬Ø¯Ø§Øª Ù…Ù† Ù…Ø¯ÙŠÙ†Ø© Ø¨Ø±ÙƒØ§Ù†... Ù…Ø±Ø­Ø¨Ø§ Ø¨ÙƒÙ… ÙÙŠ Ù…Ù†ØµØªÙƒÙ… Berkane Connect</div>
    </div>

    <section class="container mx-auto p-6 mt-16">
        <div class="flex items-center gap-4 mb-10">
            <div class="h-10 w-3 bg-amber-500 rounded-full"></div>
            <h3 class="text-3xl font-black italic uppercase tracking-tighter">ØµÙŠØ¯Ù„ÙŠØ§Øª Ø§Ù„Ø­Ø±Ø§Ø³Ø©</h3>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
            <div class="service-card-premium !p-0 overflow-hidden group">
                <div class="bg-slate-900 p-6 text-amber-500 font-black italic flex justify-between items-center px-10 group-hover:bg-black transition-all">
                    <span class="text-xl">Ø¨Ø±ÙƒØ§Ù† - Ø³ÙŠØ¯ÙŠ Ø³Ù„ÙŠÙ…Ø§Ù†</span>
                    <i class="fas fa-prescription-bottle-medical text-2xl"></i>
                </div>
                <div id="ph-berkane-content" class="p-12 text-slate-600 font-bold text-lg leading-loose">
                    <div class="flex justify-center"><div class="custom-loader"></div></div>
                </div>
            </div>
            <div class="service-card-premium !p-0 overflow-hidden group">
                <div class="bg-slate-700 p-6 text-amber-500 font-black italic flex justify-between items-center px-10 group-hover:bg-slate-800 transition-all">
                    <span class="text-xl">Ù…Ø¯ÙŠÙ†Ø© Ø£ÙƒÙ„ÙŠÙ…</span>
                    <i class="fas fa-pills text-2xl"></i>
                </div>
                <div id="ph-aklim-content" class="p-12 text-slate-600 font-bold text-lg leading-loose text-center">
                    <p class="text-slate-400 italic">ÙŠØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« ÙƒÙ„ ÙŠÙˆÙ… Ø§Ø«Ù†ÙŠÙ†...</p>
                </div>
            </div>
        </div>
    </section>

    <main class="container mx-auto p-6 py-24">
        <div class="max-w-4xl mx-auto mb-16 relative">
            <input type="text" id="engine-search" onkeyup="runEngine()" 
                placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù†: Ù†Ø¬Ø§Ø±ØŒ ØµØ¨Ø§ØºØŒ Ø­Ù„ÙˆÙŠØ§ØªØŒ Ù†Ù‚Ù„..." 
                class="w-full p-8 pr-20 rounded-[3rem] border-4 border-slate-100 focus:border-amber-500 outline-none shadow-2xl font-black text-2xl text-right transition-all bg-white">
            <div class="absolute right-8 top-1/2 -translate-y-1/2 text-slate-200 text-3xl transition-colors">
                <i class="fas fa-search-location"></i>
            </div>
        </div>

        <div class="flex gap-4 overflow-x-auto pb-12 no-scrollbar" id="filter-container">
            <button onclick="setFilter('all', event)" class="chip active"><i class="fas fa-th-large"></i> Ø§Ù„ÙƒÙ„</button>
            <button onclick="setFilter('kitchen', event)" class="chip"><i class="fas fa-utensils"></i> Ù…Ø·Ø¨Ø® ÙˆØ­Ù„ÙˆÙŠØ§Øª</button>
            <button onclick="setFilter('cosmetics', event)" class="chip"><i class="fas fa-spa"></i> Ø¹Ø§Ù„Ù… Ø§Ù„Ù…Ø±Ø£Ø©</button>
            <button onclick="setFilter('wrench', event)" class="chip"><i class="fas fa-tools"></i> Ø¥ØµÙ„Ø§Ø­ ÙˆØµÙŠØ§Ù†Ø©</button>
            <button onclick="setFilter('truck', event)" class="chip"><i class="fas fa-truck-moving"></i> Ù†Ù‚Ù„ ÙˆØªÙˆØµÙŠÙ„</button>
        </div>

        <div id="services-display" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-10">
            </div>
    </main>

    <footer class="bg-slate-900 text-white p-20 mt-20 rounded-t-[5rem]">
        <div class="container mx-auto text-center">
            <div class="text-5xl font-black italic mb-8">BERKANE<span class="text-amber-500">.</span>CONNECT</div>
            <p class="text-slate-400 font-bold max-w-2xl mx-auto leading-relaxed">Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ø±Ø³Ù…ÙŠØ© ÙˆØ§Ù„Ø´Ø§Ù…Ù„Ø© Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù‚Ø±Ø¨ Ø¨Ù…Ø¯ÙŠÙ†Ø© Ø¨Ø±ÙƒØ§Ù† ÙˆØ§Ù„Ù†ÙˆØ§Ø­ÙŠ. Ù†Ø³Ø¹Ù‰ Ù„ØªÙ‚Ø±ÙŠØ¨ Ø§Ù„Ù…Ù‡Ù†ÙŠÙŠÙ† Ù…Ù† Ø§Ù„Ù…ÙˆØ§Ø·Ù†ÙŠÙ† Ø¨ÙƒÙ„ Ø³Ù‡ÙˆÙ„Ø© ÙˆØ¨Ù†Ø©.</p>
            <div class="flex justify-center gap-8 mt-12 text-3xl text-slate-600">
                <i class="fab fa-facebook-square hover:text-blue-500 cursor-pointer transition"></i>
                <i class="fab fa-instagram hover:text-pink-500 cursor-pointer transition"></i>
                <i class="fab fa-whatsapp hover:text-green-500 cursor-pointer transition"></i>
            </div>
            <div class="mt-20 text-[10px] font-black uppercase tracking-[1em] text-slate-800">2025 Â© All Rights Reserved</div>
        </div>
    </footer>

    <div id="addModal" class="fixed inset-0 bg-slate-900/95 hidden z-[9999] flex items-center justify-center p-6 backdrop-blur-xl">
        <div class="bg-white rounded-[4rem] p-12 max-w-xl w-full relative border-t-[12px] border-amber-500 shadow-3xl animate__animated animate__zoomIn">
            <button onclick="closeModal('addModal')" class="absolute top-10 left-10 text-slate-300 hover:text-red-500 transition-colors"><i class="fas fa-times-circle text-4xl"></i></button>
            <h3 class="text-4xl font-black mb-10 italic text-slate-900">Ø³Ø¬Ù„ Ù†Ø´Ø§Ø·Ùƒ</h3>
            <div class="space-y-8">
                <div>
                    <label class="block text-[10px] font-black text-slate-400 uppercase mb-3 mr-4 tracking-widest">Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù†ÙŠ Ø£Ùˆ Ø§Ù„Ù…Ø­Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ</label>
                    <input type="text" id="f-name" class="w-full p-6 bg-slate-50 rounded-[1.5rem] border-2 border-transparent focus:border-amber-500 outline-none font-black text-right text-lg" placeholder="Ù…Ø«Ù„Ø§Ù‹: ØµØ¨Ø§Øº Ø¨Ø±ÙƒØ§Ù†">
                </div>
                <div>
                    <label class="block text-[10px] font-black text-slate-400 uppercase mb-3 mr-4 tracking-widest">Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨</label>
                    <input type="tel" id="f-phone" class="w-full p-6 bg-slate-50 rounded-[1.5rem] border-2 border-transparent focus:border-amber-500 outline-none font-black text-left text-lg" placeholder="06XXXXXXXX">
                </div>
                <div>
                    <label class="block text-[10px] font-black text-slate-400 uppercase mb-3 mr-4 tracking-widest">Ø§Ø®ØªØ± Ø§Ù„ØµÙ†Ù</label>
                    <select id="f-cat" class="w-full p-6 bg-slate-50 rounded-[1.5rem] border-2 border-transparent outline-none font-black text-lg appearance-none">
                        <option value="kitchen">ğŸ³ Ù…Ø·Ø¨Ø® ÙˆØ­Ù„ÙˆÙŠØ§Øª</option>
                        <option value="cosmetics">ğŸ’„ Ø¹Ø§Ù„Ù… Ø§Ù„Ù…Ø±Ø£Ø©</option>
                        <option value="wrench">ğŸ”§ Ø¥ØµÙ„Ø§Ø­ ÙˆØµÙŠØ§Ù†Ø©</option>
                        <option value="truck">ğŸšš Ù†Ù‚Ù„ ÙˆØªÙˆØµÙŠÙ„</option>
                    </select>
                </div>
                <button onclick="uploadService()" id="btn-submit" class="w-full bg-slate-900 text-amber-500 py-7 rounded-[1.8rem] font-black text-2xl shadow-2xl active:scale-95 transition-all">Ø§Ù†Ø´Ø± Ø®Ø¯Ù…ØªÙƒ Ø§Ù„Ø¢Ù†</button>
            </div>
        </div>
    </div>

    <div id="adminPanel" class="fixed inset-0 bg-white hidden z-[10000] overflow-y-auto animate__animated animate__slideInUp">
        <div class="container mx-auto p-12">
            <div class="flex justify-between items-center mb-16 border-b-8 border-slate-50 pb-10">
                <div>
                    <h2 class="text-5xl font-black italic text-slate-900">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
                    <p class="text-amber-500 font-bold mt-2 uppercase tracking-widest">Berkane Connect Master Access</p>
                </div>
                <button onclick="closeModal('adminPanel')" class="bg-red-50 text-red-500 px-12 py-5 rounded-[2rem] font-black text-xl hover:bg-red-500 hover:text-white transition-all shadow-lg">Ø®Ø±ÙˆØ¬ Ø¢Ù…Ù†</button>
            </div>
            
            <div class="grid grid-cols-1 xl:grid-cols-2 gap-20">
                <div class="bg-slate-50 p-12 rounded-[4rem] border-2 border-slate-100 shadow-inner">
                    <h4 class="text-2xl font-black text-amber-600 mb-10 flex items-center gap-4"><i class="fas fa-edit"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¹Ø§Ù…</h4>
                    <div class="space-y-8">
                        <div>
                            <label class="block font-black mb-2 text-slate-400 text-xs">Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ù…ØªØ­Ø±Ùƒ</label>
                            <input type="text" id="adm-news" class="w-full p-6 border-2 rounded-2xl font-bold text-right outline-none focus:border-amber-500">
                        </div>
                        <div>
                            <label class="block font-black mb-2 text-slate-400 text-xs">ØµÙŠØ¯Ù„ÙŠØ§Øª Ø§Ù„Ø­Ø±Ø§Ø³Ø© (Ø§Ø³Ù… ÙÙŠ ÙƒÙ„ Ø³Ø·Ø±)</label>
                            <textarea id="adm-ph" class="w-full p-6 border-2 rounded-2xl h-56 font-bold text-right outline-none focus:border-amber-500"></textarea>
                        </div>
                        <div>
                            <label class="block font-black mb-2 text-slate-400 text-xs">Ù…Ø¯Ø© Ø§Ù„Ø­Ø±Ø§Ø³Ø©</label>
                            <input type="text" id="adm-days" class="w-full p-6 border-2 rounded-2xl font-bold text-right outline-none focus:border-amber-500">
                        </div>
                        <button onclick="saveSystemUpdates()" class="w-full bg-amber-500 text-white py-6 rounded-2xl font-black text-2xl shadow-2xl hover:bg-amber-600 transition">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø¸Ø§Ù…</button>
                    </div>
                </div>

                <div class="bg-slate-50 p-12 rounded-[4rem] border-2 border-slate-100 shadow-inner">
                    <h4 class="text-2xl font-black text-slate-800 mb-10 flex items-center gap-4"><i class="fas fa-database"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†</h4>
                    <div id="admin-db-list" class="space-y-5 max-h-[700px] overflow-y-auto pr-4 no-scrollbar">
                        </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const FIREBASE_URL = "https://studio-2627154759-2fb87-default-rtdb.firebaseio.com";
        let localData = {};
        let activeFilter = 'all';

        // 1. Core Startup
        async function runSystem() {
            // Weather
            try {
                const wRes = await fetch('https://api.open-meteo.com/v1/forecast?latitude=34.92&longitude=-2.32&current_weather=true');
                const wData = await wRes.json();
                document.getElementById('weather-temp').innerText = Math.round(wData.current_weather.temperature) + 'Â°C';
            } catch(e) { console.error("Weather down"); }

            // Prayers
            try {
                const pRes = await fetch('https://api.aladhan.com/v1/timingsByCity?city=Berkane&country=MA&method=3');
                const pData = await pRes.json();
                const t = pData.data.timings;
                document.getElementById('fajr').innerText = t.Fajr;
                document.getElementById('dhuhr').innerText = t.Dhuhr;
                document.getElementById('asr').innerText = t.Asr;
                document.getElementById('maghrib').innerText = t.Maghrib;
                document.getElementById('isha').innerText = t.Isha;
            } catch(e) { console.error("Prayer down"); }

            // Firebase Integration
            try {
                const response = await fetch(`${FIREBASE_URL}/.json`);
                localData = await response.json() || {};
                
                // Load Admin News
                if(localData.admin?.news) {
                    document.getElementById('news-ticker').innerText = localData.admin.news;
                    document.getElementById('adm-news').value = localData.admin.news;
                }

                // Load Pharmacies
                if(localData.pharmacies_v4?.berkane) {
                    const ph = localData.pharmacies_v4.berkane;
                    document.getElementById('ph-berkane-content').innerHTML = `
                        <p class="text-amber-600 mb-4 italic text-sm font-black"><i class="fas fa-calendar-alt ml-2"></i>Ù…Ù† ØªØ§Ø±ÙŠØ®: ${ph.days}</p>
                        <div class="space-y-3">${ph.names.split('\n').map(n => `<div class="bg-slate-50 p-4 rounded-2xl"><i class="fas fa-hospital-user text-amber-500 ml-3"></i>${n}</div>`).join('')}</div>
                    `;
                    document.getElementById('adm-ph').value = ph.names;
                    document.getElementById('adm-days').value = ph.days;
                }

                renderServices(localData.services || {});
            } catch(e) { console.error("Firebase Error", e); }
        }

        // 2. Render Engine
        function renderServices(data) {
            const grid = document.getElementById('services-display');
            const keys = Object.keys(data);
            
            if(keys.length === 0) {
                grid.innerHTML = `<div class="col-span-full text-center py-32 opacity-20"><i class="fas fa-folder-open text-8xl mb-6"></i><p class="text-2xl font-black">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³Ø¬Ù„ÙŠÙ† Ø­Ø§Ù„ÙŠØ§Ù‹</p></div>`;
                return;
            }

            grid.innerHTML = keys.reverse().map(id => {
                const s = data[id];
                const catClass = s.category === 'cosmetics' ? 'cat-woman' : (s.category === 'wrench' ? 'cat-repair' : 'cat-kitchen');
                const icon = s.category === 'kitchen' ? 'fa-utensils' : (s.category === 'cosmetics' ? 'fa-wand-sparkles' : 'fa-tools');
                
                return `
                    <div class="service-card-premium animate__animated animate__fadeInUp ${catClass}">
                        <div class="w-24 h-24 bg-slate-50 rounded-[2.2rem] mx-auto mb-8 flex items-center justify-center text-4xl text-amber-500 shadow-inner">
                            <i class="fas ${icon}"></i>
                        </div>
                        <h4 class="font-black text-2xl text-slate-800 mb-2">${s.name}</h4>
                        <p class="text-[10px] font-black text-slate-300 uppercase tracking-[5px] mb-8">${s.category || 'Ø¹Ø§Ù…'}</p>
                        <a href="https://wa.me/${s.phone.replace(/^0/, '212')}" target="_blank" class="wa-button shadow-2xl">
                            <i class="fab fa-whatsapp text-2xl"></i> ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ø®Ø¯Ù…Ø©
                        </a>
                    </div>
                `;
            }).join('');
        }

        // 3. Filter & Search
        window.runEngine = () => {
            const query = document.getElementById('engine-search').value.toLowerCase();
            const filtered = Object.fromEntries(Object.entries(localData.services || {}).filter(([id, s]) => 
                (activeFilter === 'all' || s.category === activeFilter) && s.name.toLowerCase().includes(query)
            ));
            renderServices(filtered);
        };

        window.setFilter = (cat, e) => {
            activeFilter = cat;
            document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
            e.currentTarget.classList.add('active');
            window.runEngine();
        };

        // 4. Modal Control
        window.openModal = (id) => {
            document.getElementById(id).classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        };
        window.closeModal = (id) => {
            document.getElementById(id).classList.add('hidden');
            document.body.style.overflow = 'auto';
        };

        // 5. User Submission
        window.uploadService = async () => {
            const name = document.getElementById('f-name').value;
            const phone = document.getElementById('f-phone').value;
            const category = document.getElementById('f-cat').value;

            if(!name || !phone) return alert("Ø§Ù„Ù…Ø±Ø¬Ùˆ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®Ø§Ù†Ø§Øª!");
            
            const btn = document.getElementById('btn-submit');
            btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù†Ø´Ø±..."; btn.disabled = true;

            await fetch(`${FIREBASE_URL}/services.json`, { 
                method: 'POST', 
                body: JSON.stringify({ name, phone, category, timestamp: new Date().getTime() }) 
            });

            alert("ØªÙ… Ù†Ø´Ø± Ø®Ø¯Ù…ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­!");
            location.reload();
        };

        // 6. Master Security Gateway
        window.adminGateway = () => {
            const myGmail = "imadxhabja@gmail.com"; // Ø¨Ø¯Ù„Ùˆ Ø¨Ù€ Gmail Ø¯ÙŠØ§Ù„Ùƒ
            const myPass = "2025"; // Ø¨Ø¯Ù„Ùˆ Ø¨ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø§Ù„Ù„ÙŠ Ø¨ØºÙŠØªÙŠ

            const userGmail = prompt("Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯ Ø§Ù„Ù…Ø¯ÙŠØ± (Gmail):");
            const userPass = prompt("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±:");

            if(userGmail === myGmail && userPass === myPass) {
                openModal('adminPanel');
                loadAdminDB();
            } else {
                alert("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©!");
            }
        };

        async function loadAdminDB() {
            const res = await fetch(`${FIREBASE_URL}/services.json`);
            const data = await res.json() || {};
            const list = document.getElementById('admin-db-list');
            
            list.innerHTML = Object.keys(data).reverse().map(id => `
                <div class="flex justify-between items-center bg-white p-6 rounded-[2rem] border-2 border-slate-50 shadow-sm group">
                    <div>
                        <p class="font-black text-slate-800 text-lg">${data[id].name}</p>
                        <p class="text-xs text-slate-400 font-bold tracking-widest uppercase">${data[id].category} | ${data[id].phone}</p>
                    </div>
                    <button onclick="deleteEntry('${id}')" class="w-14 h-14 bg-red-50 text-red-500 rounded-2xl hover:bg-red-500 hover:text-white transition-all">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
            `).join('');
        }

        window.deleteEntry = async (id) => {
            if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØŸ")) {
                await fetch(`${FIREBASE_URL}/services/${id}.json`, { method: 'DELETE' });
                loadAdminDB();
                runSystem();
            }
        };

        window.saveSystemUpdates = async () => {
            const news = document.getElementById('adm-news').value;
            const names = document.getElementById('adm-ph').value;
            const days = document.getElementById('adm-days').value;
            
            await fetch(`${FIREBASE_URL}/admin/news.json`, { method: 'PUT', body: JSON.stringify(news) });
            await fetch(`${FIREBASE_URL}/pharmacies_v4/berkane.json`, { method: 'PUT', body: JSON.stringify({ names, days }) });
            
            alert("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„!");
            location.reload();
        };

        // Fire up
        runSystem();
    </script>
</body>
</html>
