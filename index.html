<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Berkane-Connect | Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ø§Ù„Ø·ÙˆÙŠÙ„Ø©</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap');
        
        body { 
            font-family: 'Tajawal', sans-serif; 
            background-color: #f8fafc; 
            scroll-behavior: smooth; 
        }
        
        .gradient-dark { 
            background: linear-gradient(135deg, #0f172a, #1e293b); 
        }
        
        .accent-gold { 
            background: linear-gradient(135deg, #f59e0b, #d97706); 
        }
        
        .pink-glow { 
            background: linear-gradient(135deg, #ec4899, #be185d); 
            box-shadow: 0 4px 15px rgba(236, 72, 153, 0.3); 
        }
        
        .marquee-container { 
            background: #1e293b; 
            color: #fbbf24; 
            padding: 12px 0; 
            overflow: hidden; 
            border-bottom: 2px solid #fbbf24; 
        }
        
        .marquee-text { 
            display: inline-block; 
            white-space: nowrap; 
            animation: marquee 20s linear infinite; 
            padding-right: 100%; 
            font-weight: bold; 
        }
        
        @keyframes marquee { 
            0% { transform: translateX(100%); } 
            100% { transform: translateX(-100%); } 
        }
        
        .hidden { 
            display: none !important; 
        }

        .service-card {
            transition: all 0.3s ease;
        }

        .service-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
    </style>
</head>

<body class="flex flex-col min-h-screen text-right">

    <nav class="bg-white shadow-md p-4 sticky top-0 z-50 flex justify-between items-center border-b-4 border-amber-500">
        <div class="text-2xl font-black text-slate-900 italic uppercase">
            BERKANE<span class="text-amber-500">.</span>CONNECT
        </div>
        <div class="flex gap-2">
            <button onclick="window.shareSite()" class="bg-green-100 text-green-600 p-2 rounded-xl">
                <i class="fab fa-whatsapp text-xl"></i>
            </button>
            <button onclick="window.toggleAddModal()" class="accent-gold text-white px-4 py-2 rounded-xl text-[10px] font-bold shadow-lg">
                + Ø£Ø¶Ù Ø®Ø¯Ù…Ø©
            </button>
            <button onclick="window.openAdmin()" class="bg-slate-100 p-2 rounded-xl text-slate-500">
                <i class="fas fa-user-shield"></i>
            </button>
        </div>
    </nav>

    <div class="marquee-container">
        <div class="marquee-text text-right" id="newsTicker">
            Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø±Ù‚Ù…ÙŠ Ù„Ù…Ø¯ÙŠÙ†Ø© Ø¨Ø±ÙƒØ§Ù† ÙˆØ£ÙƒÙ„ÙŠÙ….. Ù‚Ø³Ù… "Ø³ÙŠØ¯ØªÙŠ" Ù…ØªØ§Ø­ Ø§Ù„Ø¢Ù†!
        </div>
    </div>

    <section class="container mx-auto mt-4 px-4 grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="gradient-dark p-4 rounded-3xl text-white flex justify-between items-center shadow-lg border-b-4 border-amber-500">
            <div>
                <p class="text-[10px] font-bold text-amber-400 mb-1">Ø·Ù‚Ø³ Ø¨Ø±ÙƒØ§Ù† Ø§Ù„Ø¢Ù†</p>
                <h4 id="temp" class="text-4xl font-black">--Â°C</h4>
            </div>
            <div class="text-5xl text-amber-400">
                <i class="fas fa-cloud-sun"></i>
            </div>
        </div>
        <div class="bg-white p-4 rounded-3xl shadow-md border-b-4 border-slate-800 flex justify-around items-center text-[10px] font-bold">
            <div class="text-center">
                <span>Ø§Ù„ÙØ¬Ø±</span>
                <p id="fajr" class="text-sm font-black text-slate-800">--:--</p>
            </div>
            <div class="text-center">
                <span>Ø§Ù„Ø¸Ù‡Ø±</span>
                <p id="dhuhr" class="text-sm font-black text-slate-800">--:--</p>
            </div>
            <div class="text-center">
                <span>Ø§Ù„Ù…ØºØ±Ø¨</span>
                <p id="maghrib" class="text-sm font-black text-amber-600">--:--</p>
            </div>
            <div class="text-center">
                <span>Ø§Ù„Ø¹Ø´Ø§Ø¡</span>
                <p id="isha" class="text-sm font-black text-slate-800">--:--</p>
            </div>
        </div>
    </section>

    <section class="container mx-auto mt-6 px-4">
        <button onclick="window.filterByCategory('woman')" class="w-full pink-glow text-white p-6 rounded-[2.5rem] flex items-center justify-between mb-4 shadow-xl active:scale-95 transition">
            <div class="text-right">
                <h3 class="font-black text-xl">Ù‚Ø³Ù… Ø³ÙŠØ¯ØªÙŠ ğŸŒ¸</h3>
                <p class="text-[11px] opacity-90 font-bold">ØªØ¬Ù…ÙŠÙ„ØŒ Ø­Ù„Ø§Ù‚Ø©ØŒ ÙˆØ®Ø¯Ù…Ø§Øª Ù†Ø³Ø§Ø¦ÙŠØ© Ø®Ø§ØµØ©</p>
            </div>
            <i class="fas fa-magic text-4xl"></i>
        </button>
        
        <div class="relative">
            <input type="text" id="searchInput" onkeyup="window.filterServices()" 
                   placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† (Ø§Ø³Ù… Ø§Ù„Ø´Ø®ØµØŒ Ø­Ø±ÙØ©ØŒ Ø£Ùˆ Ù…Ø¯ÙŠÙ†Ø©)..." 
                   class="w-full p-5 pr-14 rounded-2xl bg-white border-2 border-slate-100 text-sm font-bold focus:border-amber-500 outline-none shadow-sm">
            <div class="absolute right-5 top-1/2 -translate-y-1/2 text-slate-400">
                <i class="fas fa-search text-xl"></i>
            </div>
        </div>
    </section>

    <section class="container mx-auto mt-10 px-4">
        <h3 class="font-black text-slate-800 mb-6 border-r-4 border-amber-500 pr-3 text-xl italic uppercase">ØµÙŠØ¯Ù„ÙŠØ§Øª Ø§Ù„Ø­Ø±Ø§Ø³Ø© Ø§Ù„ÙŠÙˆÙ…</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-white rounded-[2rem] shadow-sm border p-6 border-b-4 border-amber-400">
                <div class="font-black text-amber-600 mb-2 flex justify-between items-center">
                    <span>Ù…Ø¯ÙŠÙ†Ø© Ø¨Ø±ÙƒØ§Ù†</span>
                    <i class="fas fa-hospital"></i>
                </div>
                <div id="dispBerkane" class="text-sm text-slate-600 font-bold leading-relaxed">
                    Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...
                </div>
            </div>
            <div class="bg-white rounded-[2rem] shadow-sm border p-6 border-b-4 border-slate-700">
                <div class="font-black text-slate-700 mb-2 flex justify-between items-center">
                    <span>Ù…Ø¯ÙŠÙ†Ø© Ø£ÙƒÙ„ÙŠÙ…</span>
                    <i class="fas fa-clinic-medical"></i>
                </div>
                <div id="dispAklim" class="text-sm text-slate-600 font-bold leading-relaxed">
                    Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...
                </div>
            </div>
        </div>
    </section>

    <main class="container mx-auto py-12 px-4 flex-grow">
        <div class="flex justify-between items-center mb-8">
            <h3 class="font-black text-slate-800 border-r-4 border-slate-800 pr-3 text-xl italic uppercase">Ø§Ù„Ø­Ø±Ù ÙˆØ§Ù„Ù…Ù‡Ù† Ø§Ù„Ù…ØªØ§Ø­Ø©</h3>
            <button onclick="window.filterByCategory('all')" id="showAllBtn" class="hidden bg-amber-100 text-amber-700 px-4 py-1 rounded-full text-xs font-black">
                Ø¥Ø¸Ù‡Ø§Ø± ÙƒØ§ÙØ© Ø§Ù„Ø®Ø¯Ù…Ø§Øª
            </button>
        </div>
        <div id="listingsContainer" class="grid grid-cols-1 md:grid-cols-3 gap-6">
            </div>
        <div id="noResults" class="hidden text-center py-20 text-slate-400 font-bold italic">
            Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ù… Ù†Ø¬Ø¯ Ù†ØªØ§Ø¦Ø¬ ØªØ·Ø§Ø¨Ù‚ Ø¨Ø­Ø«Ùƒ...
        </div>
    </main>

    <div id="addModal" class="fixed inset-0 bg-black/80 hidden z-[100] flex items-center justify-center p-4">
        <div class="bg-white rounded-[2rem] p-8 w-full max-w-md relative text-right shadow-2xl">
            <button onclick="window.toggleAddModal()" class="absolute top-6 left-6 text-slate-300 hover:text-red-500">
                <i class="fas fa-times-circle text-2xl"></i>
            </button>
            <h3 class="font-black mb-6 text-xl text-slate-800">Ø³Ø¬Ù„ Ø®Ø¯Ù…ØªÙƒ ÙÙŠ Ø§Ù„Ø¯Ù„ÙŠÙ„</h3>
            <div class="space-y-4">
                <input type="text" id="uName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ Ø£Ùˆ Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„" class="w-full p-4 border rounded-2xl text-right">
                <input type="tel" id="uPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (ÙˆØ§ØªØ³Ø§Ø¨)" class="w-full p-4 border rounded-2xl text-right">
                
                <div class="grid grid-cols-2 gap-2">
                    <select id="uCat" class="p-4 border rounded-2xl bg-slate-50 font-black text-[10px]">
                        <option value="woman">ğŸŒ¸ Ù‚Ø³Ù… Ø³ÙŠØ¯ØªÙŠ (ØªØ¬Ù…ÙŠÙ„/Ø­Ù„Ø§Ù‚Ø©)</option>
                        <option value="utensils">ğŸ” Ù…Ø·Ø¹Ù… / Ù…Ù‚Ù‡Ù‰</option>
                        <option value="car">ğŸš— ÙƒØ±Ø§Ø¡ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</option>
                        <option value="bolt">âš¡ ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ / ØªÙ‚Ù†ÙŠ</option>
                        <option value="faucet">ğŸš° Ø³Ø¨Ø§Ùƒ / Ø±ØµØ§Øµ</option>
                        <option value="briefcase">ğŸ’¼ Ø­Ø±Ù ÙˆØ®Ø¯Ù…Ø§Øª Ø£Ø®Ø±Ù‰</option>
                    </select>
                    <select id="uCity" class="p-4 border rounded-2xl bg-slate-50 font-black text-[10px]">
                        <option value="Ø¨Ø±ÙƒØ§Ù†">ğŸ“ Ù…Ø¯ÙŠÙ†Ø© Ø¨Ø±ÙƒØ§Ù†</option>
                        <option value="Ø£ÙƒÙ„ÙŠÙ…">ğŸ“ Ù…Ø¯ÙŠÙ†Ø© Ø£ÙƒÙ„ÙŠÙ…</option>
                    </select>
                </div>
                
                <textarea id="uDesc" placeholder="Ù†Ø¨Ø°Ø© Ù‚ØµÙŠØ±Ø© Ø¹Ù† Ø§Ù„Ø®Ø¯Ù…Ø©..." class="w-full p-4 border rounded-2xl h-24 text-right text-sm"></textarea>
                
                <button onclick="window.addService()" id="subBtn" class="w-full accent-gold text-white py-5 rounded-2xl font-black shadow-lg hover:brightness-110 transition">
                    Ù†Ø´Ø± Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ø¢Ù†
                </button>
            </div>
        </div>
    </div>

    <div id="adminModal" class="fixed inset-0 bg-slate-900/98 hidden z-[200] flex items-center justify-center p-4 backdrop-blur-xl">
        <div class="bg-white rounded-[2rem] p-8 max-w-lg w-full max-h-[90vh] overflow-y-auto relative text-right">
            <button onclick="document.getElementById('adminModal').classList.add('hidden')" class="absolute top-6 left-6 text-slate-400">
                <i class="fas fa-times-circle text-3xl"></i>
            </button>
            
            <h3 class="font-black text-slate-800 mb-6 text-xl text-center border-b pb-4">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØµØ©</h3>
            
            <div class="grid grid-cols-2 gap-4 mb-6">
                <div class="bg-amber-500 text-white p-5 rounded-2xl text-center">
                    <p class="text-[10px] font-bold uppercase mb-1">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø²ÙˆØ§Ø±</p>
                    <span id="vCount" class="text-3xl font-black">0</span>
                </div>
                <div class="bg-blue-600 text-white p-5 rounded-2xl text-center">
                    <p class="text-[10px] font-bold uppercase mb-1">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®Ø¯Ù…Ø§Øª</p>
                    <span id="sCount" class="text-3xl font-black">0</span>
                </div>
            </div>

            <div class="bg-slate-50 p-6 rounded-3xl border mb-6">
                <label class="block text-[10px] font-bold mb-2">ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø®Ø¨Ø§Ø±:</label>
                <input type="text" id="admNews" placeholder="Ù†Øµ Ø§Ù„Ø´Ø±ÙŠØ·" class="w-full p-4 border rounded-xl mb-4 text-right">
                
                <label class="block text-[10px] font-bold mb-2">ØªØ­Ø¯ÙŠØ« ØµÙŠØ¯Ù„ÙŠØ§Øª Ø§Ù„Ø­Ø±Ø§Ø³Ø©:</label>
                <textarea id="admNames" placeholder="Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ (Ø§Ø³Ù… ÙÙŠ ÙƒÙ„ Ø³Ø·Ø±)" class="w-full p-4 border rounded-xl h-24 mb-3 text-right"></textarea>
                
                <div class="flex gap-2 mb-4">
                    <select id="admCity" class="flex-1 p-4 border rounded-xl bg-white font-bold">
                        <option value="berkane">Ø¨Ø±ÙƒØ§Ù†</option>
                        <option value="aklim">Ø£ÙƒÙ„ÙŠÙ…</option>
                    </select>
                    <input type="text" id="admDays" placeholder="ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø±Ø§Ø³Ø©" class="flex-1 p-4 border rounded-xl">
                </div>
                
                <div class="flex gap-2">
                    <button onclick="window.saveAdmin()" class="flex-1 gradient-dark text-amber-400 py-4 rounded-xl font-black text-xs">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
                    <button onclick="window.deletePharmacies()" class="flex-1 bg-red-100 text-red-600 py-4 rounded-xl font-black text-xs">Ø­Ø°Ù Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ§Øª</button>
                </div>
            </div>

            <div class="bg-red-50 p-6 rounded-3xl border border-red-100">
                <p class="text-[10px] font-bold text-red-500 mb-4">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø©:</p>
                <div id="adminServiceList" class="space-y-2 max-h-48 overflow-y-auto">
                    </div>
            </div>
        </div>
    </div>

    <footer class="gradient-dark text-white py-12 px-6 rounded-t-[3.5rem] mt-10 text-center border-t-4 border-pink-500">
        <p class="text-amber-400 font-black text-2xl mb-2 italic">BERKANE-CONNECT</p>
        <p class="text-[10px] text-slate-500 uppercase tracking-widest font-bold">
            Ø¯Ù„ÙŠÙ„Ùƒ Ø§Ù„Ø±Ù‚Ù…ÙŠ Ø§Ù„Ø£ÙˆÙ„ ÙÙŠ Ø§Ù„Ø¥Ù‚Ù„ÙŠÙ… | 2025
        </p>
    </footer>

    <script type="module">
        // Ø±ÙˆØ§Ø¨Ø· Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø±Ù…ÙˆØ²
        const BASE_URL = "https://studio-2627154759-2fb87-default-rtdb.firebaseio.com";
        const ADMIN_PIN = "2025";

        // Ø®Ø±ÙŠØ·Ø© Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª ÙˆØ§Ù„Ø£Ù„ÙˆØ§Ù†
        const themeMap = { 
            'woman': { icon: 'fa-venus', color: '#ec4899', label: 'Ø³ÙŠØ¯ØªÙŠ' }, 
            'utensils': { icon: 'fa-utensils', color: '#ef4444', label: 'Ù…Ø£ÙƒÙˆÙ„Ø§Øª' }, 
            'car': { icon: 'fa-car', color: '#1e3a8a', label: 'ÙƒØ±Ø§Ø¡' }, 
            'bolt': { icon: 'fa-bolt', color: '#f59e0b', label: 'ØªÙ‚Ù†ÙŠ' }, 
            'faucet': { icon: 'fa-faucet', color: '#06b6d4', label: 'Ø³Ø¨Ø§ÙƒØ©' }, 
            'briefcase': { icon: 'fa-briefcase', color: '#6366f1', label: 'Ø£Ø®Ø±Ù‰' } 
        };

        // ÙˆØ¸ÙŠÙØ© Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù‚Ø³
        async function fetchWeather() { 
            try { 
                const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=34.92&longitude=-2.32&current_weather=true`); 
                const data = await response.json(); 
                document.getElementById('temp').innerText = `${Math.round(data.current_weather.temperature)}Â°C`; 
            } catch(error) { 
                console.log("Weather Error"); 
            } 
        }

        // ÙˆØ¸ÙŠÙØ© Ø¬Ù„Ø¨ Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©
        async function fetchPrayers() { 
            try { 
                const response = await fetch(`https://api.aladhan.com/v1/timingsByCity?city=Berkane&country=Morocco&method=3`); 
                const data = await response.json(); 
                const t = data.data.timings; 
                document.getElementById('fajr').innerText = t.Fajr; 
                document.getElementById('dhuhr').innerText = t.Dhuhr;
                document.getElementById('maghrib').innerText = t.Maghrib; 
                document.getElementById('isha').innerText = t.Isha; 
            } catch(error) { 
                console.log("Prayer Error"); 
            } 
        }

        // ÙØªØ­ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
        window.openAdmin = async () => { 
            const input = prompt("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©:");
            if(input === ADMIN_PIN) { 
                document.getElementById('adminModal').classList.remove('hidden'); 
                loadStats(); 
                loadAdminServices(); 
            } else {
                alert("Ø±Ù…Ø² ØºÙŠØ± ØµØ­ÙŠØ­!");
            }
        };

        // ØªØ­Ù…ÙŠÙ„ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
        async function loadStats() { 
            const response = await fetch(`${BASE_URL}/admin/visitors.json`); 
            const count = await response.json() || 0; 
            document.getElementById('vCount').innerText = count; 
        }

        // ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©
        async function loadAdminServices() {
            const response = await fetch(`${BASE_URL}/services.json`); 
            const data = await response.json(); 
            const listElement = document.getElementById('adminServiceList');
            
            if(!data) { 
                document.getElementById('sCount').innerText = 0; 
                listElement.innerHTML = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø®Ø¯Ù…Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.";
                return; 
            }
            
            const keys = Object.keys(data); 
            document.getElementById('sCount').innerText = keys.length;
            
            listElement.innerHTML = keys.map(id => `
                <div class="flex justify-between items-center bg-white p-3 border rounded-xl mb-2 text-[10px] font-bold">
                    <span>${data[id].name}</span>
                    <button onclick="window.deleteItem('services/${id}')" class="text-red-500 p-2 hover:bg-red-50 rounded-lg">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `).reverse().join('');
        }

        // Ø­Ø°Ù Ø¹Ù†ØµØ± Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        window.deleteItem = async (path) => { 
            if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù†ØµØ±ØŸ")) { 
                await fetch(`${BASE_URL}/${path}.json`, { method: 'DELETE' }); 
                location.reload(); 
            } 
        };

        // Ø­Ø°Ù ØµÙŠØ¯Ù„ÙŠØ§Øª Ø§Ù„Ø­Ø±Ø§Ø³Ø©
        window.deletePharmacies = async () => { 
            const city = document.getElementById('admCity').value; 
            if(confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù ØµÙŠØ¯Ù„ÙŠØ§Øª ${city}ØŸ`)) { 
                await fetch(`${BASE_URL}/pharmacies_v4/${city}.json`, { method: 'DELETE' }); 
                location.reload(); 
            } 
        };

        // Ø­ÙØ¸ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
        window.saveAdmin = async () => { 
            const news = document.getElementById('admNews').value;
            const names = document.getElementById('admNames').value;
            const days = document.getElementById('admDays').value;
            const city = document.getElementById('admCity').value;
            
            if(news) {
                await fetch(`${BASE_URL}/admin/news.json`, { method: 'PUT', body: JSON.stringify(news) });
            }
            
            if(names && days) {
                const pharmacyData = { names: names, days: days };
                await fetch(`${BASE_URL}/pharmacies_v4/${city}.json`, { method: 'PUT', body: JSON.stringify(pharmacyData) });
            }
            
            alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!"); 
            location.reload();
        };

        // Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
        window.toggleAddModal = () => {
            document.getElementById('addModal').classList.toggle('hidden');
        };

        // Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…ÙˆÙ‚Ø¹
        window.shareSite = () => {
            const text = "Ø§ÙƒØªØ´Ù Ø§Ù„Ø®Ø¯Ù…Ø§Øª ÙˆØ§Ù„ØµÙŠØ¯Ù„ÙŠØ§Øª ÙÙŠ Ø¨Ø±ÙƒØ§Ù† ÙˆØ£ÙƒÙ„ÙŠÙ… Ø¹Ø¨Ø± Berkane-Connect: ";
            window.open(`https://wa.me/?text=${encodeURIComponent(text + window.location.href)}`, '_blank');
        };

        // Ù…Ø­Ø±Ùƒ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ÙÙˆØ±ÙŠ
        window.filterServices = () => { 
            const query = document.getElementById('searchInput').value.toLowerCase(); 
            const cards = document.querySelectorAll('.service-card');
            let found = false;
            
            cards.forEach(card => {
                if(card.innerText.toLowerCase().includes(query)) {
                    card.classList.remove('hidden');
                    found = true;
                } else {
                    card.classList.add('hidden');
                }
            });
            
            document.getElementById('noResults').classList.toggle('hidden', found);
        };

        // Ø§Ù„ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„ØªØµÙ†ÙŠÙ
        window.filterByCategory = (category) => { 
            const cards = document.querySelectorAll('.service-card');
            cards.forEach(card => {
                if(category === 'all' || card.getAttribute('data-cat') === category) {
                    card.classList.remove('hidden');
                } else {
                    card.classList.add('hidden');
                }
            });
            
            document.getElementById('showAllBtn').classList.toggle('hidden', category === 'all');
            
            if(category === 'woman') {
                window.scrollTo({ 
                    top: document.getElementById('listingsContainer').offsetTop - 100, 
                    behavior: 'smooth' 
                });
            }
        };

        // Ø¥Ø¶Ø§ÙØ© Ø®Ø¯Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©
        window.addService = async () => {
            const name = document.getElementById('uName').value;
            const phone = document.getElementById('uPhone').value;
            const category = document.getElementById('uCat').value;
            const city = document.getElementById('uCity').value;
            const desc = document.getElementById('uDesc').value;
            
            if(name && phone) {
                document.getElementById('subBtn').innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù†Ø´Ø±...";
                const newService = { 
                    name: name, 
                    phone: phone, 
                    category: category, 
                    city: city, 
                    description: desc || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ." 
                };
                await fetch(`${BASE_URL}/services.json`, { method: 'POST', body: JSON.stringify(newService) }); 
                location.reload(); 
            } else {
                alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ.");
            }
        };

        // ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        async function initializeApp() {
            fetchWeather(); 
            fetchPrayers();
            
            try {
                // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø²ÙˆØ§Ø±
                const visitorRes = await fetch(`${BASE_URL}/admin/visitors.json`); 
                let currentVisitors = await visitorRes.json() || 0; 
                fetch(`${BASE_URL}/admin/visitors.json`, { method: 'PUT', body: JSON.stringify(currentVisitors + 1) });

                // Ø¬Ù„Ø¨ Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø®Ø¨Ø§Ø±
                const newsRes = await fetch(`${BASE_URL}/admin/news.json`); 
                const newsText = await newsRes.json(); 
                if(newsText) document.getElementById('newsTicker').innerText = newsText;

                // Ø¬Ù„Ø¨ Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ§Øª
                const pharmRes = await fetch(`${BASE_URL}/pharmacies_v4.json`); 
                const pharmData = await pharmRes.json();
                if(pharmData?.berkane) {
                    renderPharmacy(pharmData.berkane, 'dispBerkane');
                }
                if(pharmData?.aklim) {
                    renderPharmacy(pharmData.aklim, 'dispAklim');
                }

                // Ø¬Ù„Ø¨ Ø§Ù„Ø®Ø¯Ù…Ø§Øª
                const servicesRes = await fetch(`${BASE_URL}/services.json`); 
                const servicesData = await servicesRes.json();
                
                if(servicesData) {
                    const container = document.getElementById('listingsContainer');
                    container.innerHTML = Object.keys(servicesData).reverse().map(id => {
                        const item = servicesData[id];
                        const theme = themeMap[item.category] || themeMap['briefcase'];
                        const isWoman = item.category === 'woman';
                        
                        // ØªÙ†Ø¸ÙŠÙ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ù„Ù„ÙˆØ§ØªØ³Ø§Ø¨
                        let cleanPhone = item.phone.trim().replace(/\s/g, '').replace(/\+/g, ''); 
                        if(cleanPhone.startsWith('0')) cleanPhone = '212' + cleanPhone.substring(1);
                        else if(!cleanPhone.startsWith('212')) cleanPhone = '212' + cleanPhone;
                        
                        return `
                        <div class="service-card ${isWoman ? 'bg-pink-50 border-pink-100' : 'bg-white'} p-6 rounded-[2rem] shadow-sm border" data-cat="${item.category}">
                            <div class="flex items-center gap-4 mb-4">
                                <div class="w-12 h-12 rounded-xl flex items-center justify-center text-white text-xl shadow-md" style="background-color: ${theme.color}">
                                    <i class="fas ${theme.icon}"></i>
                                </div>
                                <div class="flex-1">
                                    <h4 class="font-black text-slate-800 text-sm">${item.name}</h4>
                                    <div class="flex justify-between items-center">
                                        <span class="text-[9px] font-bold text-slate-400 uppercase">${theme.label}</span>
                                        <span class="text-[9px] bg-white px-2 rounded-full border text-slate-500 font-black">${item.city || 'Ø¨Ø±ÙƒØ§Ù†'}</span>
                                    </div>
                                </div>
                            </div>
                            <p class="text-[10px] text-slate-500 mb-4 italic line-clamp-2">${item.description}</p>
                            <a href="https://wa.me/${cleanPhone}" target="_blank" class="block w-full text-center py-3 ${isWoman ? 'bg-pink-600' : 'bg-slate-900'} text-white rounded-xl text-[10px] font-black shadow-lg">
                                ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
                            </a>
                        </div>`;
                    }).join('');
                }
            } catch(error) {
                console.log("Init Error");
            }
        }

        // Ø±Ø³Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ§Øª
        function renderPharmacy(data, elementId) { 
            const namesList = data.names.split('\n').filter(n => n.trim() !== "").map(n => `
                <div class="font-bold py-1 border-b border-slate-50">ğŸ“ ${n}</div>
            `).join(''); 
            
            document.getElementById(elementId).innerHTML = `
                <div class="text-[9px] text-amber-600 font-black mb-2 italic">Ø­Ø±Ø§Ø³Ø© Ø¨ØªØ§Ø±ÙŠØ®: ${data.days}</div>
                ${namesList}
            `; 
        }

        // Ø§Ù†Ø·Ù„Ø§Ù‚ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        initializeApp();
    </script>
</body>
</html>
